$(function(){"use strict";function a(a){return a%400===0?!0:a%100===0?!1:a%4===0}function b(b,c){function d(a,b){return Math.round((a.getTime()-b.getTime())/1e3)}for(var e,f,g,h=(new Date).getFullYear(),i=new Date(h,0,0,0,0,0,0).getTime(),j=365+(a(h)?1:0),k=[],l=[],m=[],n=[],o=new Date(h,2,20).toDateString(),p=new Date(h,5,21).toDateString(),q=new Date(h,8,23).toDateString(),r=new Date(h,11,21).toDateString(),s=(new Date).toDateString(),t=0;j>t;t++)k[t]=new Date(i+24*(t+1)*36e5),f=k[t].toDateString(),(f===o||f===p||f===q||f===r)&&n.push(t),f===s&&(g=t),e=SunCalc.getTimes(k[t],b,c),l[t]=d(e.sunset,e.sunrise),t>0&&(m[t]=l[t]-l[t-1]);return m[0]=l[0]-l[l.length-1],{dates:k,durations:l,diffs:m,events:n,today:g}}function c(a,b){function c(a,b){n.lineTo(a+p.xoffset,b+p.yoffset)}function d(a){var b=Math.floor(a/60),c=a-60*b,d=""+b+":"+c;return d.length<4?d+"0":d}function f(a,b){var c,e;for(c=a;b(c,a);c+=a)e=p.yoffset-c*s,n.fillText(d(c),0,e),n.moveTo(p.xoffset-2,e),n.lineTo(p.maxWidth,e)}var g,h,i,j,k,l,m=b.diffs,n=a.getContext("2d"),o=a.height-30,p={maxWidth:a.width,maxHeight:o,xoffset:30.5,yoffset:Math.floor(o/2),gridStep:20},q=Math.min.apply(null,m),r=Math.max.apply(null,m),s=.9*p.maxHeight/Math.abs(r-q);for(n.clearRect(0,0,a.width,a.height),n.font="9px sans-serif",n.textBaseline="middle",n.beginPath(),n.lineWidth=1,n.strokeStyle="#888",n.fillStyle="#888",n.moveTo(p.xoffset,0),n.lineTo(p.xoffset,p.maxHeight),n.moveTo(p.xoffset-5,p.yoffset),c(p.maxWidth,0),n.fillText("0",0,p.yoffset),n.stroke(),n.beginPath(),n.strokeStyle="#ccc",n.fillStyle="#888",f(p.gridStep,function(a,b){return r+b>a}),f(-p.gridStep,function(a,b){return a>q+b}),n.stroke(),g=(p.maxWidth-p.xoffset)/m.length,n.beginPath(),n.strokeStyle="#00f",n.lineWidth=.5,h=0;h<b.events.length;h++)i=p.xoffset+g*b.events[h],n.moveTo(i,0),n.lineTo(i,p.maxHeight);for(n.stroke(),n.beginPath(),n.strokeStyle="#f00",i=p.xoffset+g*b.today,n.moveTo(i,0),n.lineTo(i,p.maxHeight),n.stroke(),l=p.xoffset,h=0;h<e.length;h++)j=e[h].days*(p.maxWidth-p.xoffset)/m.length,k=n.measureText(e[h].name).width,n.fillStyle=e[h].fill,n.fillRect(l,p.maxHeight+5,j,20),n.fillStyle="#000",n.fillText(e[h].name,l+(j-k)/2,p.maxHeight+16),l+=j;for(n.beginPath(),n.lineWidth=3,n.strokeStyle="rgba(151,187,205,1)",n.moveTo(p.xoffset,p.yoffset-m[0]*s),h=1;h<m.length;h++)c(h*g,-m[h]*s);n.stroke()}function d(a,d){var e=b(a,d),f=new Date,g=SunCalc.getTimes(f,a,d);c($("#chart").get(0),e),$("#lat-box").text(a.toFixed(8)),$("#lon-box").text(d.toFixed(8)),$("#today-box").text(f.toLocaleDateString()),$("#sunrise-box").text(g.sunrise.toLocaleTimeString()),$("#sunset-box").text(g.sunset.toLocaleTimeString())}var e=[{name:"Jan",days:31,fill:"rgba(0,   255, 128, 0.4)"},{name:"Feb",days:a((new Date).getFullYear())?29:28,fill:"rgba(0, 205, 128, 0.4)"},{name:"Mar",days:31,fill:"rgba(51,  153, 128, 0.4)"},{name:"Apr",days:30,fill:"rgba(102, 102, 128, 0.4)"},{name:"May",days:31,fill:"rgba(153, 51,  128, 0.4)"},{name:"Jun",days:30,fill:"rgba(204, 0,   128, 0.4)"},{name:"Jul",days:31,fill:"rgba(255, 0,   128, 0.4)"},{name:"Aug",days:31,fill:"rgba(204, 0,   128, 0.4)"},{name:"Sep",days:30,fill:"rgba(153, 51,  128, 0.4)"},{name:"Oct",days:31,fill:"rgba(102, 102, 128, 0.4)"},{name:"Nov",days:30,fill:"rgba(51,  153, 128, 0.4)"},{name:"Dec",days:31,fill:"rgba(0,   204, 128, 0.4)"}],f=new OpenLayers.LonLat(0,0),g=new OpenLayers.Map({div:"map",theme:null,controls:[new OpenLayers.Control.Navigation,new OpenLayers.Control.Zoom],layers:[new OpenLayers.Layer.OSM("OpenStreetMap",null,{transitionEffect:"resize",attribution:""})],center:f,zoom:1}),h=new OpenLayers.Projection("EPSG:900913"),i=new OpenLayers.Projection("EPSG:4326");g.events.register("click",g,function(a){var b=g.getLonLatFromViewPortPx(a.xy).transform(h,i);console.log("Coordinates: "+b.lat+", "+b.lon),d(b.lat,b.lon)}),d(51.5,0)});