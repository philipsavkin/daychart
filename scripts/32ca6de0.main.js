$(function(){"use strict";function a(a){return a%400===0?!0:a%100===0?!1:a%4===0}function b(b,c){function d(a){return!isNaN(a.getTime())}function e(a,b){return Math.round((a.getTime()-b.getTime())/1e3)}for(var f,g,h,i=(new Date).getFullYear(),j=new Date(i,0,1,0,0,0,0).getTime(),k=365+(a(i)?1:0),l=[],m=[],n=[],o=[],p=new Date(i,2,20,12).toDateString(),q=new Date(i,5,21,12).toDateString(),r=new Date(i,8,23,12).toDateString(),s=new Date(i,11,21,12).toDateString(),t=(new Date).toDateString(),u=0;k>u;u++)l[u]=new Date(j+24*(u+1)*36e5),g=l[u].toDateString(),(g===p||g===q||g===r||g===s)&&o.push(u),g===t&&(h=u),f=SunCalc.getTimes(l[u],b,c),m[u]=d(f.sunset)&&d(f.sunrise)?e(f.sunset,f.sunrise):0,u>0&&(n[u]=m[u]-m[u-1]);return n[0]=m[0]-m[m.length-1],{dates:l,durations:m,diffs:n,events:o,today:h}}function c(a,b){function c(a,b){n.lineTo(a+p.xoffset,b+p.yoffset)}function d(a){var b=Math.round(Math.abs(a)),c=0>a?"-":"",d=Math.floor(b/60),e=Math.round(b-60*d);return c+d+":"+(10>e?"0":"")+e}function f(a){var b=p.yoffset-a*s;n.moveTo(p.xoffset-2,b),n.lineTo(p.maxWidth,b),n.fillText(d(a),0,b)}var g,h,i,j,k,l,m=b.diffs,n=a.getContext("2d"),o=a.height-30,p={maxWidth:a.width,maxHeight:o,xoffset:30.5,yoffset:Math.floor(o/2),gridStep:20},q=Math.min.apply(null,m),r=Math.max.apply(null,m),s=.9*p.maxHeight/Math.abs(r-q);for(n.clearRect(0,0,a.width,a.height),n.font="9px sans-serif",n.textBaseline="middle",n.beginPath(),n.lineWidth=1,n.strokeStyle="#888",n.fillStyle="#888",n.moveTo(p.xoffset,0),n.lineTo(p.xoffset,p.maxHeight),n.moveTo(p.xoffset-5,p.yoffset),c(p.maxWidth,0),n.fillText("0",0,p.yoset),n.stroke(),n.beginPath(),n.strokeStyle="#888",f(r),f(r/2),f(q),f(q/2),n.stroke(),g=(p.maxWidth-p.xoffset)/m.length,n.beginPath(),n.strokeStyle="#06c",n.lineWidth=.5,h=0;h<b.events.length;h++)i=p.xoffset+g*b.events[h],n.moveTo(i,0),n.lineTo(i,p.maxHeight);for(n.stroke(),n.beginPath(),n.strokeStyle="#f40",i=p.xoffset+g*b.today,n.moveTo(i,0),n.lineTo(i,p.maxHeight),n.stroke(),l=p.xoffset,h=0;h<e.length;h++)j=e[h].days*(p.maxWidth-p.xoffset)/m.length,k=n.measureText(e[h].name).width,n.fillStyle=e[h].fill,n.fillRect(l,p.maxHeight+5,j,20),n.fillStyle="#000",n.fillText(e[h].name,l+(j-k)/2,p.maxHeight+16),l+=j;for(n.beginPath(),n.lineWidth=3,n.strokeStyle="rgba(0,128,0,0.5)",n.moveTo(p.xoffset,p.yoffset-m[0]*s),h=1;h<m.length;h++)c(h*g,-m[h]*s);n.stroke()}function d(a,d){var e=b(a,d),f=new Date,g=SunCalc.getTimes(f,a,d);c($("#chart").get(0),e),$("#lat-box").text(a.toFixed(8)),$("#lon-box").text(d.toFixed(8)),$("#today-box").text(f.toLocaleDateString()),$("#sunrise-box").text(g.sunrise.toLocaleTimeString()),$("#sunset-box").text(g.sunset.toLocaleTimeString())}var e=[{name:"Jan",days:31,fill:"rgba(0,   255, 128, 0.4)"},{name:"Feb",days:a((new Date).getFullYear())?29:28,fill:"rgba(0, 205, 128, 0.4)"},{name:"Mar",days:31,fill:"rgba(51,  153, 128, 0.4)"},{name:"Apr",days:30,fill:"rgba(102, 102, 128, 0.4)"},{name:"May",days:31,fill:"rgba(153, 51,  128, 0.4)"},{name:"Jun",days:30,fill:"rgba(204, 0,   128, 0.4)"},{name:"Jul",days:31,fill:"rgba(255, 0,   128, 0.4)"},{name:"Aug",days:31,fill:"rgba(204, 0,   128, 0.4)"},{name:"Sep",days:30,fill:"rgba(153, 51,  128, 0.4)"},{name:"Oct",days:31,fill:"rgba(102, 102, 128, 0.4)"},{name:"Nov",days:30,fill:"rgba(51,  153, 128, 0.4)"},{name:"Dec",days:31,fill:"rgba(0,   204, 128, 0.4)"}],f=new L.Map("map");f.addLayer(new L.TileLayer("http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{minZoom:2,maxZoom:12,attribution:'Map data Â© <a href="http://openstreetmap.org">OpenStreetMap</a> contributors'})),f.setView([0,0],2),f.on("click",function(a){d(a.latlng.lat,a.latlng.lng)}),d(55,0),$.get("http://ipinfo.io",function(a){var b=a.loc.split(",",2);d(parseFloat(b[0]),parseFloat(b[1]))},"jsonp")});