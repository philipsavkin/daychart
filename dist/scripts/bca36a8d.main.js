$(function(){"use strict";function a(a){return a%400===0?!0:a%100===0?!1:a%4===0}function b(b,c){function d(a,b){return Math.round((a.getTime()-b.getTime())/1e3)}for(var e,f,g,h=(new Date).getFullYear(),i=new Date(h,0,0,0,0,0,0).getTime(),j=365+(a(h)?1:0),k=[],l=[],m=[],n=[],o=new Date(h,2,20).toDateString(),p=new Date(h,5,21).toDateString(),q=new Date(h,8,23).toDateString(),r=new Date(h,11,21).toDateString(),s=(new Date).toDateString(),t=0;j>t;t++)k[t]=new Date(i+24*(t+1)*36e5),f=k[t].toDateString(),(f===o||f===p||f===q||f===r)&&n.push(t),f===s&&(g=t),e=SunCalc.getTimes(k[t],b,c),l[t]=d(e.sunset,e.sunrise),t>0&&(m[t]=l[t]-l[t-1]);return m[0]=l[0]-l[l.length-1],{dates:k,durations:l,diffs:m,events:n,today:g}}function c(a,b){function c(a,b){m.lineTo(a+o.xoffset,b+o.yoffset)}function d(a){var b=Math.floor(a/60),c=a-60*b,d=""+b+":"+c;return d.length<4?d+"0":d}function f(a,b){var c,e;for(c=a;b(c,a);c+=a)e=o.yoffset-c*r,m.strokeText(d(c),0,e),m.moveTo(o.xoffset-2,e),m.lineTo(o.maxWidth,e)}var g,h,i,j,k,l=b.diffs,m=a.getContext("2d"),n=a.height-40,o={maxWidth:a.width,maxHeight:n,xoffset:30.5,yoffset:Math.floor(n/2),gridStep:20},p=Math.min.apply(null,l),q=Math.max.apply(null,l),r=.9*o.maxHeight/Math.abs(q-p);for(m.clearRect(0,0,a.width,a.height),m.font="9px Arial",m.textBaseline="middle",m.beginPath(),m.lineWidth=1,m.strokeStyle="#888888",m.moveTo(o.xoffset,0),m.lineTo(o.xoffset,o.maxHeight),m.moveTo(o.xoffset-5,o.yoffset),c(o.maxWidth,0),m.strokeText("0",0,o.yoffset),m.stroke(),m.beginPath(),m.strokeStyle="#cccccc",f(o.gridStep,function(a,b){return q+b>a}),f(-o.gridStep,function(a,b){return a>p+b}),m.stroke(),g=(o.maxWidth-o.xoffset)/l.length,m.beginPath(),h=0;h<b.events.length;h++)i=o.xoffset+g*b.events[h],m.moveTo(i,0),m.lineTo(i,o.maxHeight);for(m.stroke(),m.beginPath(),m.lineWidth=2,m.strokeStyle="#888888",i=o.xoffset+g*b.today,m.moveTo(i,0),m.lineTo(i,o.maxHeight),m.stroke(),m.lineWidth=1,m.strokeStyle="#000",k=o.xoffset,h=0;h<e.length;h++)j=e[h].days*(o.maxWidth-o.xoffset)/l.length,m.fillStyle=e[h].fill,m.fillRect(k,o.maxHeight+20,j,20),m.strokeText(e[h].name,k,o.maxHeight+30),k+=j;for(m.beginPath(),m.lineWidth=3,m.strokeStyle="rgba(151,187,205,1)",m.moveTo(o.xoffset,o.yoffset-l[0]*r),h=1;h<l.length;h++)c(h*g,-l[h]*r);m.stroke()}function d(a,d){var e=b(a,d),f=new Date,g=SunCalc.getTimes(f,a,d);c($("#chart").get(0),e),$("#lat-box").text(a.toFixed(8)),$("#lon-box").text(d.toFixed(8)),$("#today-box").text(f.toLocaleDateString()),$("#sunrise-box").text(g.sunrise.toLocaleTimeString()),$("#sunset-box").text(g.sunset.toLocaleTimeString())}var e=[{name:"Jan",days:31,fill:"rgba(0,   255, 128, 0.4)"},{name:"Feb",days:a((new Date).getFullYear())?29:28,fill:"rgba(0, 205, 128, 0.4)"},{name:"Mar",days:31,fill:"rgba(51,  153, 128, 0.4)"},{name:"Apr",days:30,fill:"rgba(102, 102, 128, 0.4)"},{name:"May",days:31,fill:"rgba(153, 51,  128, 0.4)"},{name:"Jun",days:30,fill:"rgba(204, 0,   128, 0.4)"},{name:"Jul",days:31,fill:"rgba(255, 0,   128, 0.4)"},{name:"Aug",days:31,fill:"rgba(204, 0,   128, 0.4)"},{name:"Sep",days:30,fill:"rgba(153, 51,  128, 0.4)"},{name:"Oct",days:31,fill:"rgba(102, 102, 128, 0.4)"},{name:"Nov",days:30,fill:"rgba(51,  153, 128, 0.4)"},{name:"Dec",days:31,fill:"rgba(0,   204, 128, 0.4)"}],f=new OpenLayers.LonLat(0,0),g=new OpenLayers.Map({div:"map",theme:null,controls:[new OpenLayers.Control.Navigation,new OpenLayers.Control.TouchNavigation({dragPanOptions:{enableKinetic:!0}}),new OpenLayers.Control.Zoom],layers:[new OpenLayers.Layer.OSM("OpenStreetMap",null,{transitionEffect:"resize",attribution:""})],center:f,zoom:1}),h=new OpenLayers.Projection("EPSG:900913"),i=new OpenLayers.Projection("EPSG:4326");g.events.register("click",g,function(a){var b=g.getLonLatFromViewPortPx(a.xy).transform(h,i);console.log("Coordinates: "+b.lat+", "+b.lon),d(b.lat,b.lon)}),d(51.5,0)});